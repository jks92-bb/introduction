---
description: ê°„ë‹¨í•œ ê²Œì„ì»¤ë®¤ë‹ˆí‹° ì‚¬ì´íŠ¸ë¥¼ ì œì‘í–ˆìŠµë‹ˆë‹¤.
---

# ê²Œì„ì»¤ë®¤ë‹ˆí‹°ì‚¬ì´íŠ¸

* /ğŸ—“ï¸í”„ë¡œì íŠ¸ ê¸°ê°„\[24.01.10\~24.02.16]

### í”„ë¡œì íŠ¸ ê°œìš”

<details>

<summary>ğŸ“Œê°œë°œ ëª©ì </summary>

ê²Œì„ì„ ì¦ê¸°ëŠ” ìœ ì €ë“¤ì˜ ì†Œí†µê³µê°„ì„ ë§Œë“¤ê³ ì í•˜ì˜€ìŠµë‹ˆë‹¤.

</details>

<details>

<summary>ğŸ› í™œìš© ë„êµ¬</summary>

<img src="https://img.shields.io/badge/java-007396?style=for-the-badge&#x26;logo=java&#x26;logoColor=white" alt="" data-size="original"><img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&#x26;logo=html5&#x26;logoColor=white" alt="" data-size="original"><img src="https://img.shields.io/badge/css-1572B6?style=for-the-badge&#x26;logo=css3&#x26;logoColor=white" alt="" data-size="original"><img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&#x26;logo=javascript&#x26;logoColor=black" alt="" data-size="original"><img src="https://img.shields.io/badge/jquery-0769AD?style=for-the-badge&#x26;logo=jquery&#x26;logoColor=white" alt="" data-size="original"><img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&#x26;logo=mysql&#x26;logoColor=white" alt="" data-size="original"><img src="https://img.shields.io/badge/eclipseide-2C2255?style=for-the-badge&#x26;logo=eclipseide&#x26;logoColor=white" alt="" data-size="original"><img src="https://img.shields.io/badge/bootstrap-7952B3?style=for-the-badge&#x26;logo=bootstrap&#x26;logoColor=white" alt="" data-size="original"><img src="https://img.shields.io/badge/apachetomcat-F8DC75?style=for-the-badge&#x26;logo=apachetomcat&#x26;logoColor=white" alt="" data-size="original"><img src="https://img.shields.io/badge/github-181717?style=for-the-badge&#x26;logo=github&#x26;logoColor=white" alt="" data-size="original">

</details>

<details>

<summary>âš™ï¸êµ¬ì„±</summary>

JSON, JSTL.MYSQLì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë°›ì•„ì˜µë‹ˆë‹¤.

<img src="../../../.gitbook/assets/lib.PNG" alt="" data-size="original">

ê° ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ ì„¤ëª…ì…ë‹ˆë‹¤.

**1.json-simple.jar:** `json-simple`ì€ JSON ë°ì´í„°ë¥¼ ë‹¤ë£¨ê¸° ìœ„í•œ Java ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. JSONì€ JavaScript Object Notationì˜ ì•½ì–´ë¡œ, ë°ì´í„°ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ êµí™˜í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ê²½ëŸ‰ì˜ ë°ì´í„° êµí™˜ í˜•ì‹ì…ë‹ˆë‹¤. `json-simple.jar`ëŠ” JSON ë°ì´í„°ë¥¼ ìƒì„±í•˜ê³  íŒŒì‹±í•˜ëŠ” ë° ë„ì›€ì´ ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤.

**2.jstl.jar (JavaServer Pages Standard Tag Library):** JSTLì€ JavaServer Pages (JSP)ì—ì„œ ì‚¬ìš©ë˜ëŠ” í‘œì¤€ íƒœê·¸ ë¼ì´ë¸ŒëŸ¬ë¦¬ì…ë‹ˆë‹¤. JSTLì€ JSP í˜ì´ì§€ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” ì¼ë°˜ì ì¸ ì‘ì—…ë“¤ì„ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ íƒœê·¸ë“¤ì„ ì œê³µí•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, ë£¨í”„, ì¡°ê±´ë¬¸, ë°ì´í„° í¬ë§¤íŒ… ë“±ì„ ì²˜ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. `jstl.jar` íŒŒì¼ì€ ì´ëŸ¬í•œ JSTL íƒœê·¸ë“¤ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.

**3.mysql-connector.jar:** `mysql-connector`ëŠ” MySQL ë°ì´í„°ë² ì´ìŠ¤ì™€ Java ì–´í”Œë¦¬ì¼€ì´ì…˜ ê°„ì˜ ì—°ê²°ì„ ì§€ì›í•˜ê¸° ìœ„í•œ JDBC(Java Database Connectivity) ë“œë¼ì´ë²„ì…ë‹ˆë‹¤. Java ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ MySQL ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ê³  ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. `mysql-connector.jar` íŒŒì¼ì€ ì´ ë“œë¼ì´ë²„ë¥¼ í¬í•¨í•˜ê³  ìˆì–´ì„œ Java ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ MySQLê³¼ ìƒí˜¸ ì‘ìš©í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

***

Controller, Command, PostCommand, DTO, DAOì™€ ì—¬ëŸ¬ html,jspíŒŒì¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.

<img src="../../../.gitbook/assets/íŒ¨í„´ (1).PNG" alt="" data-size="original">

***

</details>

<details>

<summary>ğŸ“ƒì¤‘ì  ì½”ë“œ</summary>

#### server.xml

ì•„ë˜ì˜ ì½”ë“œëŠ” í†°ìº£ server.xml íŒŒì¼ì—ì„œ Resource ìš”ì†Œë¥¼ ì§€ì •í•´ì¤˜ì•¼ í•œë‹¤. ì§€ì •í•´ì£¼ëŠ” ì´ìœ ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì™€ ì—°ë™í•˜ê¸° ìœ„í•¨ì´ë‹¤. passwordëŠ” ì œê±°í•˜ì—¬ ì˜¬ë ¸ìŠµë‹ˆë‹¤.

```xml
<Context docBase="gamecoummunity" path="/gamecommunity"  reloadable="true" source="org.eclipse.jst.jee.server:gamecoummunity">
			<Resource auth="Container" driverClassName="com.mysql.jdbc.Driver" name="jdbc/mysql" password="" type="javax.sql.DataSource" url="jdbc:mysql://localhost:3306/apidb" username="root"/>
			</Context>
			</Host>
		</Engine>
	</Service>
</Server>
```

#### ChatEndpoint.java

ì•„ë˜ì˜ ì½”ë“œëŠ” WebSocketë¥¼ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•œ ì±„íŒ…ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤. ê°ê° ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ ê°„ì— ì‹¤ì‹œê°„ ì±„íŒ…ì„ ê°€ëŠ¥ì¼€ í•˜ì˜€ìŠµë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ì—ì„œ WebSocketì„ í†µí•´ ì„œë²„ì— ì ‘ì†í•´ ë©”ì‹œì§€ë¥¼ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```java
package com.project.Controller;

import java.io.IOException;
import java.util.Collections;
import java.util.HashSet;
import java.util.Set;

import javax.servlet.http.HttpSession;
import javax.websocket.EndpointConfig;
import javax.websocket.HandshakeResponse;
import javax.websocket.OnClose;
import javax.websocket.OnMessage;
import javax.websocket.OnOpen;
import javax.websocket.Session;
import javax.websocket.server.HandshakeRequest;
import javax.websocket.server.ServerEndpoint;
import javax.websocket.server.ServerEndpointConfig;

@ServerEndpoint(value = "/chat", configurator = ChatEndpoint.HttpSessionConfigurator.class)
public class ChatEndpoint {

    private static Set<Session> sessions = Collections.synchronizedSet(new HashSet<>());

    @OnOpen
    public void onOpen(Session session, EndpointConfig config) {
        HttpSession httpSession = (HttpSession) config.getUserProperties().get(HttpSession.class.getName());

        if (httpSession != null) {
            String userId = (String) httpSession.getAttribute("id");
            session.getUserProperties().put("userId", userId); 
            sessions.add(session);
            // ê³ ìœ ë²ˆí˜¸+ ì•„ì´ë”” 
            //broadcast("User connected: " + userId + " (Session ID: " + userId + ")");
            // ì•„ì´ë””
            broadcast("User connected: " + userId);
        } else {
            System.out.println("HttpSession is null");
        }
    }

    @OnClose
//    public void onClose(Session session) {
//        sessions.remove(session);
//        broadcast("User disconnected: (Session ID: " + session.getId() + ")");
//    }
    public void onClose(Session session) {
        String userId = (String) session.getUserProperties().get("userId");
        sessions.remove(session);
        broadcast("User disconnected: " + userId);
    }

    @OnMessage
//    public void onMessage(String message, Session session) {
//        broadcast("[" + session.getId() + "] " + message);
//    }
    public void onMessage(String message, Session session) {
        String userId = (String) session.getUserProperties().get("userId");
        broadcast("[" + userId + "] " + message);
    }
//    public void onMessage(String message, String userId)
//    {
//       broadcast("[" + userId + "] " + message);
//    }

 // ì´ ë©”ì„œë“œëŠ” WebSocket ì„¸ì…˜ ëª©ë¡ì— ìˆëŠ” ëª¨ë“  ì„¸ì…˜ì—ê²Œ ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•©ë‹ˆë‹¤.
    private void broadcast(String message) {
        // ì„¸ì…˜ ëª©ë¡ì„ ìˆœíšŒí•˜ë©° ê° ì„¸ì…˜ì— ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.
        for (Session session : sessions) {
            try {
            	 //String userId = (String) session.getUserProperties().get("userId");
            	// í•´ë‹¹ ì„¸ì…˜ì—ê²Œ í…ìŠ¤íŠ¸ ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.
                 session.getBasicRemote().sendText(message);
                
               // session.getBasicRemote().sendText(message);
            } catch (IOException e) {
                // ë©”ì‹œì§€ ì „ì†¡ ì¤‘ì— IOExceptionì´ ë°œìƒí•˜ë©´ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ê³  ì½˜ì†”ì— ì¶œë ¥í•©ë‹ˆë‹¤.
                e.printStackTrace();
            }
        }
    }


    // HttpSessionConfigurator class
    public static class HttpSessionConfigurator extends ServerEndpointConfig.Configurator {
        @Override
        public void modifyHandshake(ServerEndpointConfig sec, HandshakeRequest request, HandshakeResponse response) {
            // HttpSessionì„ ê°€ì ¸ì™€ì„œ configì— ì €ì¥
            HttpSession httpSession = (HttpSession) request.getHttpSession();
            sec.getUserProperties().put(HttpSession.class.getName(), httpSession);
        }
    }
}

```

ì•„ë˜ëŠ” ë©”ì„œë“œì— ëŒ€í•œ ì„¤ëª…ì…ë‹ˆë‹¤.

1. @ServerEndpoint(value = "/chat", onfigurator=ChatEndpoint.HttpSessionConfigurator.class)

WebSocket ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. "/chat" ê²½ë¡œë¡œ WebSocket ìš”ì²­ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤. HttpSessionConfiguratorë¥¼ ì‚¬ìš©í•˜ì—¬ WebSocket ì„¸ì…˜ì— HttpSessionì„ ì—°ê²°í•©ë‹ˆë‹¤.&#x20;

onOpen(Session session, EndpointConfig config)

ìƒˆë¡œìš´ WebSocket ì„¸ì…˜ì´ ì—´ë¦´ ë•Œ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤. ì—°ê²°ëœ HttpSessionì—ì„œ ì‚¬ìš©ì ì•„ì´ë””ë¥¼ ê°€ì ¸ì™€ì„œ WebSocket ì„¸ì…˜ì˜ ì‚¬ìš©ì ì†ì„±ì— ì €ì¥í•©ë‹ˆë‹¤. ì„¸ì…˜ì„ ì„¸ì…˜ ëª©ë¡ì— ì¶”ê°€í•˜ê³ , ì‚¬ìš©ìê°€ ì±„íŒ…ì— ì°¸ì—¬í–ˆë‹¤ëŠ” ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•©ë‹ˆë‹¤.

2. &#x20;onClose(Session session)

WebSocket ì„¸ì…˜ì´ ë‹«í ë•Œ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤. ì„¸ì…˜ ëª©ë¡ì—ì„œ ì„¸ì…˜ì„ ì œê±°í•˜ê³ , ì‚¬ìš©ìê°€ ì±„íŒ…ì—ì„œ ë‚˜ê°”ë‹¤ëŠ” ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•©ë‹ˆë‹¤.&#x20;

3. onMessage(String message, Session session)

í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ë©”ì‹œì§€ê°€ ë„ì°©í–ˆì„ ë•Œ í˜¸ì¶œë˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤. í•´ë‹¹ ì„¸ì…˜ì— ì—°ê²°ëœ ì‚¬ìš©ì ì•„ì´ë””ë¥¼ ê°€ì ¸ì™€ì„œ ë©”ì‹œì§€ë¥¼ ì¡°í•©í•˜ê³ , ëª¨ë“  ì„¸ì…˜ì—ê²Œ í•´ë‹¹ ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•©ë‹ˆë‹¤.

4. broadcast(String message)

ì„¸ì…˜ ëª©ë¡ì— ìˆëŠ” ëª¨ë“  ì„¸ì…˜ì—ê²Œ ë©”ì‹œì§€ë¥¼ ë¸Œë¡œë“œìºìŠ¤íŠ¸í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤. HttpSessionConfigurator

WebSocket ì„¸ì…˜ì— HttpSessionì„ ì—°ê²°í•˜ê¸° ìœ„í•œ êµ¬ì„± í´ë˜ìŠ¤ì…ë‹ˆë‹¤. modifyHandshake ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ HttpSessionì„ ê°€ì ¸ì™€ WebSocket ì„¸ì…˜ êµ¬ì„±ì— ì¶”ê°€í•©ë‹ˆë‹¤.

***

ë©”ì¸í™”ë©´ì—ì„œ ì‚¬ìš©í•œ ì±„íŒ…ì°½ ì½”ë“œì…ë‹ˆë‹¤.

```html
  ëŒ€í™”ì°½
             <div id="chat"></div>
    <input type="text" id="messageInput" onkeydown="handleKeyPress(event)" />
    <button onclick="sendMessage()"> Send</button>
    <script>
        const ws = new WebSocket("ws://localhost:8182/webTeamPJ/chat");

        ws.onopen = function(event) {
            appendMessage("ëŒ€í™”ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”");
        };

        ws.onmessage = function(event) {
            const message = event.data;
            appendMessage(message);
            //const userId = session.getAttribute("id");
            //appendMessage("[" + userId + "] " + message);
            
        };

        ws.onclose = function(event) {
            appendMessage("WebSocket connection closed");
        };

        // ë©”ì‹œì§€ ì „ì†¡
        function sendMessage() {
            const messageInput = document.getElementById("messageInput");
            const message = messageInput.value;

            ws.send(message);
            messageInput.value = "";
        }

        //ë©”ì‹œì§€ ì¶œë ¥
        function appendMessage(message) {
            const chatDiv = document.getElementById("chat");
            const messageDiv = document.createElement("div");
            messageDiv.textContent = message;
            chatDiv.appendChild(messageDiv);
            
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }
        
        // ì—”í„° í‚¤ í•¸ë“¤ë§
        function handleKeyPress(event) {
            if (event.key === "Enter") {
                sendMessage();
                event.preventDefault(); // ì—”í„° í‚¤ì˜ ê¸°ë³¸ ë™ì‘(ìƒˆ ì¤„ ì¶”ê°€)ì„ ë§‰ìŠµë‹ˆë‹¤.
            }
        }
    </script>

```

</details>

<details>

<summary>ğŸ”í”„ë¡œì íŠ¸ git ì£¼ì†Œ</summary>

[https://github.com/db-ung/web\_pj](https://github.com/db-ung/web\_pj)

</details>
